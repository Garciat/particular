<body style="margin:0"></body>
<script>
'use script';

// === SETUP

const SPACEW = document.body.clientWidth;
const SPACEH = document.body.clientHeight;

const canvas = document.createElement('canvas');
canvas.width = SPACEW;
canvas.height = SPACEH;
document.body.appendChild(canvas);

const ctx = canvas.getContext('2d');

// === MATHS

Math.TAU = 2 * Math.PI;

class Vec2 {
    constructor(x, y) {
        this.x = x || 0;
        this.y = y || 0;
    }

    copy() {
        return new Vec2(this.x, this.y);
    }

    add(v) {
        return this.copy().add_(v);
    }

    add_(v) {
        this.x += v.x;
        this.y += v.y;
        return this;
    }

    smul(k) {
        return this.copy().smul_(k);
    }

    smul_(k) {
        this.x *= k;
        this.y *= k;
        return this;
    }

    static fromXY(x, y) {
        return new Vec2(x, y);
    }

    static fromRads(r) {
        return new Vec2(Math.cos(r), Math.sin(r));
    }

    static fromAngle(a) {
        return Vec2.fromRads(a / 360 * Math.TAU);
    }
}

// === GENERATION

function uniformI(a, b) {
    return Math.floor(a + (b - a) * Math.random());
}

function makeChispa(pos, spd) {
    return {
        pos: pos,
        spd: spd
    };
}

function* makeSpark(x, y, n) {
    for (let i = 0; i < n; ++i) {
        const pos = Vec2.fromXY(x, y);
        const spd = Vec2.fromRads(Math.random() * Math.TAU).smul(20 * Math.random());
        yield makeChispa(pos, spd);
    }
}

// === STATE

let chispitas = [];

// === EVENTS

canvas.addEventListener('click', function (ev) {
    chispitas = chispitas.concat(Array.from(makeSpark(ev.clientX, ev.clientY, uniformI(30, 50))));
});

// === DRAWING

function draw() {
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, SPACEW, SPACEH);

    for (let chispa of chispitas) {
        ctx.fillStyle = 'yellow';
        ctx.fillRect(chispa.pos.x, chispa.pos.y, 10, 10);

        chispa.pos.add_(chispa.spd);
        chispa.spd.add_(Vec2.fromXY(0, 1));
    }
}

function loop() {
    draw();
    requestAnimationFrame(loop);
}

// === GO !

loop();

</script>